> # ! 本项目已停止维护
> # 新项目链接： [https://github.com/drdon1234/astrbot_plugin_media_parser](https://github.com/drdon1234/astrbot_plugin_media_parser)

<br>
<br>
<br>
<br>
<br>

# AstrBot B站直链解析插件

## 功能特色
- ✅ 兼容QQ、微信等多平台
- ✅ 自动识别并解析B站视频链接（BV号）
- ✅ 支持番剧链接解析
- ✅ 自动展开b23短链
- ✅ 提供无水印直链下载
- ✅ 智能批量处理多链接
- ✅ 支持视频大小限制配置
- ✅ 支持群组黑名单/白名单模式
- ✅ 支持消息集合打包发送

---

## 安装方法

### 依赖库安装

使用前请先安装以下依赖库：
- aiohttp

在您的终端输入以下命令并回车：
```
pip install aiohttp
```

### 插件安装

1. **通过插件市场安装**  
   - 打开 "AstrBot WebUI" -> "插件市场" -> "右上角搜索"
   - 搜索唯一标识符：`astrbot_plugin_bilibili_bot`
   - 找到插件后点击安装

2. **通过GitHub仓库链接安装**  
   - 打开 "AstrBot WebUI" -> "插件市场" -> "右下角 '+' 按钮"
   - 输入以下地址并点击安装：
   ```
   https://github.com/drdon1234/astrbot_plugin_bilibili_bot
   ```

---

## 配置说明

插件提供了丰富的配置选项，您可以在 "AstrBot WebUI" -> "插件管理" -> 找到本插件 -> "操作" -> "插件配置" 中进行设置：

| 配置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `is_auto_parse` | 布尔值 | `true` | 是否自动解析聊天中出现的B站链接 |
| `is_auto_pack` | 布尔值 | `true` | 是否将解析结果打包为消息集合（微信平台建议禁用） |
| `max_video_size_mb` | 浮点型 | `0.0` | 最大允许发送的视频大小（MB），超过此大小的视频将被跳过，设置为0表示不限制 |
| `group_blacklist_mode` | 布尔值 | `true` | 群组黑名单模式，`true`表示黑名单模式，`false`表示白名单模式 |
| `group_list` | 列表 | `[]` | 群组ID列表，黑名单模式下表示禁止使用的群组，白名单模式下表示允许使用的群组 |

---

## 使用方法

### 自动解析模式
- **配置方式**: 将 `is_auto_parse` 设置为 `true`（默认开启）
- **使用场景**: 自动识别并解析聊天中出现的B站链接
- **支持的链接类型**: 
  - 完整B站视频链接：`https://www.bilibili.com/video/BV1xx411c7m9`
  - 番剧链接：`https://www.bilibili.com/bangumi/play/ep123456`
  - b23短链：`https://b23.tv/xxx123`
  - 单独BV号：`BV1xx411c7m9`

### 手动解析命令
- **调用方式**: 发送 `B站解析 [链接]` 或 `b站解析 [链接]` 或 `bilibili解析 [链接]`
- **使用场景**: 自动解析关闭时的主动调用方式
- **示例**: `B站解析 https://www.bilibili.com/video/BV1xx411c7m9`

### 批量解析功能
- **功能说明**: 机器人将自动识别消息中的所有B站链接，并依次解析
- **结果返回**: 根据 `is_auto_pack` 配置，以消息集合或单独消息的形式返回所有解析结果

---

## 使用建议
1. 在 "AstrBot WebUI" 中打开 "回复时引用消息" 功能，提升交互体验
2. 控制批量解析时的链接数量，一次解析太多会导致消息发送速度变慢
3. 微信平台使用时，请禁用 `is_auto_pack` 配置，避免消息发送失败
4. 根据网络环境和存储空间，合理设置 `max_video_size_mb` 限制
5. 对于大型群组，建议使用白名单模式，只允许特定群组使用插件

---

## 已知问题
- 微信平台可能无法正确推送视频消息（疑似AstrBot消息处理问题）
- QQ平台无法以单独发送的形式推送多个图片消息（疑似Napcat消息处理问题）

---

## 更新日志

### v1.0
- 初始版本发布
- 支持B站视频链接自动解析
- 支持番剧链接解析
- 支持b23短链自动展开
- 支持无水印直链下载
- 支持批量解析功能
- 支持视频大小限制配置
- 支持群组黑名单/白名单模式

---

## 贡献

欢迎提交Issue和Pull Request来帮助改进插件！

---

## 许可证

本项目采用MIT许可证，详情请查看 [LICENSE](LICENSE) 文件。

---

## 鸣谢

- 视频信息抓取方法参考自B站API
- 感谢AstrBot团队提供的插件开发框架

